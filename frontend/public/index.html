<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typhoon Casualty Prediction System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }
        
        .input-section {
            padding: 40px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }
        
        .output-section {
            padding: 40px;
            background: white;
        }
        
        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .prediction-result {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .risk-level {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        
        .risk-low { background: #d4edda; color: #155724; }
        .risk-moderate { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        .risk-extreme { background: #f5c6cb; color: #721c24; animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .prediction-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e1e5e9;
        }
        
        .prediction-value {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .prediction-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .recommendations {
            background: #e8f4f8;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .recommendations h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .recommendations ul {
            list-style: none;
            padding: 0;
        }
        
        .recommendations li {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .model-status {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå™Ô∏è Typhoon Casualty Prediction System</h1>
            <p>Advanced ML-based prediction for typhoon impact assessment in the Philippines</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">Weather Input Parameters</h2>
                
                <div id="modelStatus" class="model-status" style="display: none;"></div>
                
                <form id="predictionForm">
                    <div class="form-group">
                        <label for="typhoonName">Typhoon Name:</label>
                        <input type="text" id="typhoonName" value="SAMPLE TYPHOON" placeholder="Enter typhoon name">
                    </div>
                    
                    <div class="form-group">
                        <label for="region">Region:</label>
                        <select id="region">
                            <option value="Region I">Region I (Ilocos Region)</option>
                            <option value="Region II" selected>Region II (Cagayan Valley)</option>
                            <option value="Region III">Region III (Central Luzon)</option>
                            <option value="NCR">NCR (Metro Manila)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="province">Province:</label>
                        <input type="text" id="province" value="CAGAYAN" placeholder="Enter province">
                    </div>
                    
                    <div class="form-group">
                        <label for="cityMunicipality">City/Municipality:</label>
                        <input type="text" id="cityMunicipality" value="APARRI" placeholder="Enter city/municipality">
                    </div>
                    
                    <div class="form-group">
                        <label for="distanceKm">Distance from Eye (km):</label>
                        <input type="number" id="distanceKm" value="5" min="0" max="500" step="0.1" placeholder="Distance in kilometers">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxRainfall24hr">Max 24hr Rainfall (mm):</label>
                        <input type="number" id="maxRainfall24hr" value="200" min="0" max="1000" step="0.1" placeholder="Maximum 24-hour rainfall">
                    </div>
                    
                    <div class="form-group">
                        <label for="totalRainfall">Total Storm Rainfall (mm):</label>
                        <input type="number" id="totalRainfall" value="400" min="0" max="2000" step="0.1" placeholder="Total storm rainfall">
                    </div>
                    
                    <div class="form-group">
                        <label for="minPressure">Minimum Pressure (hPa):</label>
                        <input type="number" id="minPressure" value="930" min="800" max="1020" step="0.1" placeholder="Minimum central pressure">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxWindSpeed">Max Sustained Wind Speed (km/h):</label>
                        <input type="number" id="maxWindSpeed" value="220" min="30" max="300" step="1" placeholder="Maximum sustained wind speed">
                    </div>
                    
                    <div class="form-group">
                        <label for="duration">Duration in PAR (hours):</label>
                        <input type="number" id="duration" value="150" min="1" max="500" step="1" placeholder="Duration in Philippine Area of Responsibility">
                    </div>
                    
                    <button type="submit" class="btn" id="predictBtn">
                        üîÆ Predict Casualties
                    </button>
                    
                    <button type="button" class="btn" id="sampleBtn" style="margin-top: 10px; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                        üìä Load Sample Data
                    </button>
                </form>
            </div>
            
            <div class="output-section">
                <h2 class="section-title">Prediction Results</h2>
                
                <div id="predictionOutput">
                    <div class="loading">
                        <p>Enter weather parameters and click "Predict Casualties" to see results.</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">The AI model will analyze the typhoon conditions and predict potential casualties.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let modelLoaded = false;

        // Check model status on page load
        async function checkModelStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/model-status`);
                const status = await response.json();
                
                const statusDiv = document.getElementById('modelStatus');
                if (status.loaded) {
                    statusDiv.innerHTML = `‚úÖ Model loaded: ${status.model_type} | Features: ${status.features_count} | Targets: ${status.targets_count}`;
                    statusDiv.style.display = 'block';
                    modelLoaded = true;
                } else {
                    statusDiv.innerHTML = `‚ùå Model not loaded. Please check if the model files exist.`;
                    statusDiv.style.display = 'block';
                    statusDiv.className = 'error';
                }
            } catch (error) {
                console.error('Error checking model status:', error);
            }
        }

        // Load sample data
        async function loadSampleData() {
            try {
                const response = await fetch(`${API_BASE}/api/sample-input`);
                const sampleData = await response.json();
                
                document.getElementById('typhoonName').value = sampleData.typhoon_name;
                document.getElementById('region').value = sampleData.region;
                document.getElementById('province').value = sampleData.province;
                document.getElementById('cityMunicipality').value = sampleData.city_municipality;
                document.getElementById('distanceKm').value = sampleData.distance_km;
                document.getElementById('maxRainfall24hr').value = sampleData.max_24hr_rainfall_mm;
                document.getElementById('totalRainfall').value = sampleData.total_storm_rainfall_mm;
                document.getElementById('minPressure').value = sampleData.min_pressure_hpa;
                document.getElementById('maxWindSpeed').value = sampleData.max_sustained_wind_kph;
                document.getElementById('duration').value = sampleData.duration_in_par_hours;
            } catch (error) {
                alert('Error loading sample data: ' + error.message);
            }
        }

        // Make prediction
        async function makePrediction(formData) {
            const outputDiv = document.getElementById('predictionOutput');
            outputDiv.innerHTML = '<div class="loading">üîÑ Analyzing typhoon conditions...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Prediction failed');
                }

                const result = await response.json();
                displayPredictionResult(result);
                
            } catch (error) {
                outputDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Display prediction results
        function displayPredictionResult(result) {
            const outputDiv = document.getElementById('predictionOutput');
            
            const riskClass = `risk-${result.risk_level.toLowerCase()}`;
            
            let html = `
                <div class="prediction-result">
                    <div class="risk-level ${riskClass}">
                        Risk Level: ${result.risk_level}
                    </div>
                    
                    <div class="predictions-grid">
                        <div class="prediction-card">
                            <div class="prediction-value">${Math.round(result.predictions.Dead || 0)}</div>
                            <div class="prediction-label">Expected Fatalities</div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-value">${Math.round(result.predictions['Injured/Ill'] || 0)}</div>
                            <div class="prediction-label">Expected Injured/Ill</div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-value">${Math.round(result.predictions.Missing || 0)}</div>
                            <div class="prediction-label">Expected Missing</div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-value">${Math.round(result.predictions.Families || 0)}</div>
                            <div class="prediction-label">Affected Families</div>
                        </div>
                    </div>
                    
                    <div class="recommendations">
                        <h3>üö® Emergency Recommendations</h3>
                        <ul>
                            ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            outputDiv.innerHTML = html;
        }

        // Form submission handler
        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                typhoon_name: document.getElementById('typhoonName').value,
                region: document.getElementById('region').value,
                province: document.getElementById('province').value,
                city_municipality: document.getElementById('cityMunicipality').value,
                distance_km: parseFloat(document.getElementById('distanceKm').value),
                max_24hr_rainfall_mm: parseFloat(document.getElementById('maxRainfall24hr').value),
                total_storm_rainfall_mm: parseFloat(document.getElementById('totalRainfall').value),
                min_pressure_hpa: parseFloat(document.getElementById('minPressure').value),
                max_sustained_wind_kph: parseFloat(document.getElementById('maxWindSpeed').value),
                duration_in_par_hours: parseFloat(document.getElementById('duration').value)
            };
            
            await makePrediction(formData);
        });

        // Sample data button handler
        document.getElementById('sampleBtn').addEventListener('click', loadSampleData);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkModelStatus();
        });
    </script>
</body>
</html>
